<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لعبة إكس أو - Tic Tac Toe</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        @media (max-width: 640px) {
            .cell-3x3 { width: 80px; height: 80px; font-size: 2rem; }
            .cell-5x5 { width: 50px; height: 50px; font-size: 1.5rem; }
            .cell-10x10 { width: 30px; height: 30px; font-size: 0.8rem; }
        }
        
        @media (min-width: 641px) {
            .cell-3x3 { width: 100px; height: 100px; font-size: 2.5rem; }
            .cell-5x5 { width: 70px; height: 70px; font-size: 2rem; }
            .cell-10x10 { width: 40px; height: 40px; font-size: 1rem; }
        }
    </style>
</head>
<body class="bg-black min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const TicTacToeGame = () => {
            const [boardSize, setBoardSize] = useState(3);
            const [gameMode, setGameMode] = useState('player');
            const [board, setBoard] = useState([]);
            const [currentPlayer, setCurrentPlayer] = useState('X');
            const [winner, setWinner] = useState(null);
            const [isDraw, setIsDraw] = useState(false);
            const [gameHistory, setGameHistory] = useState([]);
            const [score, setScore] = useState({ X: 0, O: 0, draws: 0 });

            // تهيئة اللوحة عند تغيير الحجم
            useEffect(() => {
                initializeBoard();
            }, [boardSize]);

            const initializeBoard = () => {
                const newBoard = Array(parseInt(boardSize)).fill(null).map(() => 
                    Array(parseInt(boardSize)).fill(null)
                );
                setBoard(newBoard);
                setWinner(null);
                setIsDraw(false);
                setCurrentPlayer('X');
                setGameHistory([]);
            };

            const handleCellClick = (row, col) => {
                if (board[row][col] || winner || isDraw) return;
                
                const newBoard = board.map(r => [...r]);
                newBoard[row][col] = currentPlayer;
                setBoard(newBoard);
                
                // حفظ الحركة في التاريخ
                setGameHistory(prev => [...prev, { player: currentPlayer, row, col }]);
                
                checkWinner(newBoard, currentPlayer);
                checkDraw(newBoard);
                
                const nextPlayer = currentPlayer === 'X' ? 'O' : 'X';
                setCurrentPlayer(nextPlayer);
                
                // إذا كان نمط اللعب ضد الكمبيوتر وكان الدور للكمبيوتر
                if (gameMode === 'computer' && nextPlayer === 'O' && !winner && !isDraw) {
                    setTimeout(computerMove, 500);
                }
            };

            const computerMove = () => {
                const emptyCells = [];
                board.forEach((row, rowIndex) => {
                    row.forEach((cell, colIndex) => {
                        if (!cell) emptyCells.push([rowIndex, colIndex]);
                    });
                });
                
                if (emptyCells.length > 0) {
                    const randomIndex = Math.floor(Math.random() * emptyCells.length);
                    const [row, col] = emptyCells[randomIndex];
                    handleCellClick(row, col);
                }
            };

            const checkWinner = (currentBoard, player) => {
                const size = currentBoard.length;
                
                // التحقق من الصفوف
                for (let i = 0; i < size; i++) {
                    if (currentBoard[i].every(cell => cell === player)) {
                        handleWin(player);
                        return;
                    }
                }
                
                // التحقق من الأعمدة
                for (let i = 0; i < size; i++) {
                    const column = currentBoard.map(row => row[i]);
                    if (column.every(cell => cell === player)) {
                        handleWin(player);
                        return;
                    }
                }
                
                // التحقق من القطر الرئيسي
                const mainDiagonal = [];
                for (let i = 0; i < size; i++) {
                    mainDiagonal.push(currentBoard[i][i]);
                }
                if (mainDiagonal.every(cell => cell === player)) {
                    handleWin(player);
                    return;
                }
                
                // التحقق من القطر الثانوي
                const antiDiagonal = [];
                for (let i = 0; i < size; i++) {
                    antiDiagonal.push(currentBoard[i][size - 1 - i]);
                }
                if (antiDiagonal.every(cell => cell === player)) {
                    handleWin(player);
                    return;
                }
            };

            const handleWin = (player) => {
                setWinner(player);
                setScore(prev => ({
                    ...prev,
                    [player]: prev[player] + 1
                }));
            };

            const checkDraw = (currentBoard) => {
                const isBoardFull = currentBoard.flat().every(cell => cell !== null);
                if (isBoardFull && !winner) {
                    setIsDraw(true);
                    setScore(prev => ({
                        ...prev,
                        draws: prev.draws + 1
                    }));
                }
            };

            const undoMove = () => {
                if (gameHistory.length === 0) return;
                
                const lastMove = gameHistory[gameHistory.length - 1];
                const newBoard = board.map(r => [...r]);
                newBoard[lastMove.row][lastMove.col] = null;
                
                setBoard(newBoard);
                setGameHistory(prev => prev.slice(0, -1));
                setCurrentPlayer(lastMove.player);
                setWinner(null);
                setIsDraw(false);
            };

            const resetScore = () => {
                setScore({ X: 0, O: 0, draws: 0 });
            };

            const getCellClass = () => {
                return `cell-${boardSize}x${boardSize}`;
            };

            const getGridClass = () => {
                return `grid gap-2 mb-6 grid-cols-${boardSize}`;
            };

            return (
                <div className="min-h-screen bg-black text-red-600 flex flex-col items-center justify-center p-4">
                    <h1 className="text-4xl font-bold mb-6 text-center">لعبة إكس أو ✗ ○</h1>
                    
                    {/* لوحة النتائج */}
                    <div className="bg-red-900 p-4 rounded-lg mb-6 w-full max-w-md">
                        <h2 className="text-xl font-bold mb-2 text-center">النتائج</h2>
                        <div className="flex justify-around">
                            <div className="text-center">
                                <div className="text-2xl font-bold text-white">✗</div>
                                <div>{score.X}</div>
                            </div>
                            <div className="text-center">
                                <div className="text-xl font-bold">تعادل</div>
                                <div>{score.draws}</div>
                            </div>
                            <div className="text-center">
                                <div className="text-2xl font-bold text-black">○</div>
                                <div>{score.O}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div className="mb-6 flex flex-col sm:flex-row gap-4 w-full max-w-md">
                        <div className="flex flex-col items-center flex-1">
                            <label className="text-lg mb-2">حجم اللوحة:</label>
                            <select 
                                value={boardSize} 
                                onChange={(e) => setBoardSize(parseInt(e.target.value))}
                                className="bg-red-600 text-black px-3 py-2 rounded w-full"
                            >
                                <option value={3}>3x3</option>
                                <option value={5}>5x5</option>
                                <option value={10}>10x10</option>
                            </select>
                        </div>
                        
                        <div className="flex flex-col items-center flex-1">
                            <label className="text-lg mb-2">نمط اللعب:</label>
                            <select 
                                value={gameMode} 
                                onChange={(e) => setGameMode(e.target.value)}
                                className="bg-red-600 text-black px-3 py-2 rounded w-full"
                            >
                                <option value="player">لاعب مقابل لاعب</option>
                                <option value="computer">لاعب مقابل كمبيوتر</option>
                            </select>
                        </div>
                    </div>
                    
                    <div className="mb-4 flex gap-2">
                        <button 
                            onClick={initializeBoard}
                            className="bg-red-600 text-black px-4 py-2 rounded-lg font-semibold hover:bg-red-700 transition"
                        >
                            لعب مرة أخرى
                        </button>
                        <button 
                            onClick={undoMove}
                            disabled={gameHistory.length === 0}
                            className="bg-red-800 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-900 transition disabled:opacity-50"
                        >
                            تراجع
                        </button>
                        <button 
                            onClick={resetScore}
                            className="bg-red-800 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-900 transition"
                        >
                            تصفير النتائج
                        </button>
                    </div>
                    
                    <div className="mb-4 text-xl font-bold">
                        {winner ? (
                            <div className="flex items-center gap-2">
                                <span>الفائز: </span>
                                <span className={winner === 'X' ? 'text-white' : 'text-black'}>
                                    {winner === 'X' ? '✗' : '○'}
                                </span>
                            </div>
                        ) : isDraw ? (
                            <p>تعادل! ⚖️</p>
                        ) : (
                            <div className="flex items-center gap-2">
                                <span>دور اللاعب: </span>
                                <span className={currentPlayer === 'X' ? 'text-white' : 'text-black'}>
                                    {currentPlayer === 'X' ? '✗' : '○'}
                                </span>
                            </div>
                        )}
                    </div>
                    
                    <div className={getGridClass()}>
                        {board.map((row, rowIndex) => (
                            row.map((cell, colIndex) => (
                                <button
                                    key={`${rowIndex}-${colIndex}`}
                                    className={`${getCellClass()} bg-red-900 flex items-center justify-center font-bold border-2 border-red-600 
                                             hover:bg-red-800 transition ${cell === 'X' ? 'text-white' : cell === 'O' ? 'text-black' : 'text-red-400'}`}
                                    onClick={() => handleCellClick(rowIndex, colIndex)}
                                    disabled={!!winner || isDraw}
                                >
                                    {cell === 'X' ? '✗' : cell === 'O' ? '○' : ''}
                                </button>
                            ))
                        ))}
                    </div>
                    
                    <div className="text-center mt-6 text-red-400">
                        <p>لعبة إكس أو - تم التطوير بألوان الأحمر والأسود</p>
                        <p>حجم اللوحة: {boardSize}x{boardSize} | النمط: {gameMode === 'player' ? 'لاعبان' : 'لاعب vs كمبيوتر'}</p>
                    </div>
                </div>
            );
        };

        // عرض اللعبة
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TicTacToeGame />);
    </script>
</body>
</html>
